# Blueprints Composer Setup

This package explores using composer to resolve Blueprint resources. This way we could
take advantage of Composer's:

* Caching
* Parallel downloads
* Support for GIT, SVN, private repositories, packagist, and more

## Setup

Run `composer install` to install WooCommerce, Gutenberg, and the pendant theme in `wp-content`.

The dependencies are defined in `composer.json`. We also use the `composer/installers` package
to define custom installation paths:

```json
{
	"extra": {
		"installer-paths": {
			"wp-content/mu-plugins/{$name}/": [
				"type:wordpress-muplugin"
			],
			"wp-content/plugins/{$name}/": [
				"type:wordpress-plugin"
			],
			"wp-content/themes/{$name}/": [
				"type:wordpress-theme"
			]
		}
	}
}
```

The `composer/installers` package is included in this project to explore building Blueprints with
a pre-bundled version of all the required dependencies.

## Discussion

Making Composer behave like a library seems challenging:

* Progress reporting – it isn't yet clear how to extract the progress of the installation process. We'll need to
  figure that out to provide visual feedback.
* Cache adapters – we need to cache in the browser, wp-now, and in native PHP.
* Download adapters – we need to proxy network calls through fetch() in web browsers.

Perhaps implementing a custom installer would be a better approach? Blueprints could still support composer.json
as a separate step.

## Intended usage

The Blueprints package will most likely generate a composer.json file with all the required
dependencies, and then run the composer installation pipeline while observing the progress
events.

For example, this Blueprint:

```json
{
	"steps": [
		{
			"step": "installPlugin",
			"pluginZipFile": {
				"resource": "wordpress.org/plugins",
				"slug": "coblocks"
			}
		},
		{
			"step": "installTheme",
			"themeZipFile": {
				"resource": "wordpress.org/themes",
				"slug": "pendant"
			}
		}
	]
}
```

Would become a composer.json file like this:

```json
{
	"require": {
		"composer/installers": "*@dev",
		"wordpress-plugin:coblocks": "*",
		"wordpress-plugin:pendant": "*"
	},
	"extra": {
		"installer-paths": {
			"wp-content/plugins/{$name}/": [
				"type:wordpress-plugin"
			],
			"wp-content/themes/{$name}/": [
				"type:wordpress-theme"
			]
		}
	},
	"config": {
		"optimize-autoloader": true,
		"preferred-install": "dist",
		"allow-plugins": {
			"composer/installers": true
		}
	},
	"repositories": [
		"Lengthy, autogenerated list of repositories"
	]
}
```
